<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Lý - Admin</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
</head>
<body>

<header>
    <h1>Trang Quản Lý Bán Hàng</h1>
</header>

<div class="sidebar">
    <a href="#" onclick="showSection('products')"><i class="fas fa-box"></i> Quản Lý Sản Phẩm</a>
    <a href="#" onclick="showSection('orders')"><i class="fas fa-receipt"></i> Quản Lý Đơn Hàng</a>
    <a href="#" onclick="showSection('revenue')"><i class="fas fa-chart-line"></i> Doanh Thu Cửa Hàng</a>
    <a href="#" onclick="showSection('revenueHistory')"><i class="fas fa-history"></i> Lịch Sử Doanh Thu</a>
    <a href="#"><i class="fas fa-sign-out-alt"></i> Đăng Xuất</a>
</div>

<div class="main-content">
    <div class="card" id="products">
        <h2>Danh Sách Sản Phẩm</h2>
        <button class="add-btn" onclick="showAddProductModal()">Thêm Sản Phẩm</button>
        <table id="productTable">
            <thead>
                <tr>
                    <th>Tên Sản Phẩm</th>
                    <th>Giá</th>
                    <th>Số Lượng</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody>
                <!-- Sản phẩm sẽ được nạp ở đây -->
            </tbody>
        </table>
    </div>

    <div class="card" id="orders" style="display:none;">
        <h2>Danh Sách Đơn Hàng</h2>
        <table>
            <thead>
                <tr>
                    <th>Mã Đơn Hàng</th>
                    <th>Khách Hàng</th>
                    <th>Tổng Tiền</th>
                    <th>Trạng Thái</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>001</td>
                    <td>Nguyễn Văn A</td>
                    <td>95,000 VND</td>
                    <td>Đang xử lý</td>
                    <td><button onclick="viewOrder('001')">Xem Chi Tiết</button></td>
                </tr>
                <tr>
                    <td>002</td>
                    <td>Trần Thị B</td>
                    <td>120,000 VND</td>
                    <td>Hoàn thành</td>
                    <td><button onclick="viewOrder('002')">Xem Chi Tiết</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card" id="revenue" style="display:none;">
        <h2>Doanh Thu Cửa Hàng</h2>
        <table>
            <thead>
                <tr>
                    <th>Tháng Hiện Tại</th>
                    <th>Tổng Doanh Thu</th>
                </tr>
            </thead>
            <tbody id="revenueCurrent">
                <!-- Doanh thu tháng hiện tại sẽ được nạp ở đây -->
            </tbody>
        </table>
    </div>

    <div class="card" id="revenueHistory" style="display:none;">
        <h2>Lịch Sử Doanh Thu</h2>
        <table>
            <thead>
                <tr>
                    <th>Tháng</th>
                    <th>Tổng Doanh Thu</th>
                </tr>
            </thead>
            <tbody id="revenueHistoryTable">
                <!-- Doanh thu tháng trước sẽ được nạp ở đây -->
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Thêm Sản Phẩm -->
<div class="modal" id="addProductModal">
    <div class="modal-content">
        <h3>Thêm Sản Phẩm Mới</h3>
        <div class="form-group">
            <label for="productName">Tên Sản Phẩm:</label>
            <input type="text" id="productName" required>
        </div>
        <div class="form-group">
            <label for="productPrice">Giá:</label>
            <input type="number" id="productPrice" required>
        </div>
        <div class="form-group">
            <label for="productQuantity">Số Lượng:</label>
            <input type="number" id="productQuantity" required>
        </div>
        <button onclick="addProduct()">Thêm</button>
        <button class="modal-close" onclick="closeModal('addProductModal')">Đóng</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadProducts();
        loadRevenue();
    });

    function loadProducts() {
        fetch('/api/products')
            .then(response => response.json())
            .then(data => {
                const productTableBody = document.querySelector('#productTable tbody');
                productTableBody.innerHTML = '';
                data.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td>${product.price} VND</td>
                        <td>${product.quantity}</td>
                        <td>
                            <button class="edit-btn" onclick="showEditProductModal(this)">Sửa</button>
                            <button class="delete-btn" onclick="deleteProduct(this)">Xóa</button>
                        </td>
                    `;
                    productTableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Lỗi khi nạp sản phẩm:', error));
    }

    function loadRevenue() {
        fetch('/api/revenue')
            .then(response => response.json())
            .then(data => {
                const currentRevenueBody = document.getElementById('revenueCurrent');
                const revenueHistoryBody = document.getElementById('revenueHistoryTable');

                currentRevenueBody.innerHTML = `
                    <tr>
                        <td>${data.currentMonth}</td>
                        <td>${data.currentRevenue} VND</td>
                    </tr>
                `;

                revenueHistoryBody.innerHTML = '';
                data.history.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.month}</td>
                        <td>${item.revenue} VND</td>
                    `;
                    revenueHistoryBody.appendChild(row);
                });
            })
            .catch(error => console.error('Lỗi khi nạp doanh thu:', error));
    }

    function showSection(section) {
        const sections = document.querySelectorAll('.main-content > .card');
        sections.forEach(s => s.style.display = 'none');
        document.getElementById(section).style.display = 'block';
    }

    function showAddProductModal() {
        document.getElementById('addProductModal').style.display = 'flex';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    function addProduct() {
        const name = document.getElementById('productName').value;
        const price = document.getElementById('productPrice').value;
        const quantity = document.getElementById('productQuantity').value;

        // Logic thêm sản phẩm vào bảng
        fetch('/api/products', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, price, quantity })
        })
        .then(response => response.json())
        .then(() => {
            loadProducts();
            closeModal('addProductModal');
        })
        .catch(error => console.error('Lỗi khi thêm sản phẩm:', error));
    }

    function showEditProductModal(button) {
        // Logic chỉnh sửa sản phẩm
    }

    function deleteProduct(button) {
        const row = button.closest('tr');
        row.remove();
        // Logic xóa sản phẩm từ API
    }

    function viewOrder(orderId) {
        // Logic xem chi tiết đơn hàng
    }
</script>

</body>
</html>
